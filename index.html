<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartDispute.ai - Resolve Your Dispute</title>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5L7PTHJK');</script>
  <!-- End Google Tag Manager -->
  
  <!-- SmartDispute GTM Integration -->
  <script src="/gtm.js"></script>
  
  <!-- Empathetic Loading Script -->
  <script src="{{ url_for('static', filename='js/empathetic-loading.js') }}"></script>
  <style>
    :root {
      --primary: #ff0000;
      --background: #000000;
      --foreground: #ffffff;
      --accent-dark: #111111;
    }
    body {
      margin: 0;
      padding: 0;
      background-color: var(--background);
      color: var(--foreground);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 40px 20px;
    }
    h1, h2 {
      color: var(--primary);
    }
    .cta {
      background-color: var(--accent-dark);
      border-left: 6px solid var(--primary);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    ul {
      padding-left: 20px;
    }
    ul li {
      margin-bottom: 8px;
    }
    .paypal-secure {
      font-size: 0.9em;
      color: #bbb;
      margin-top: 10px;
    }
    .testimonials {
      background-color: var(--accent-dark);
      padding: 20px;
      border-radius: 8px;
    }
    .testimonial {
      font-style: italic;
      margin-bottom: 10px;
    }
    .button-container {
      margin: 20px 0;
    }
    a {
      color: var(--primary);
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L7PTHJK"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <div class="container">
    <h1>SmartDispute.ai</h1>
    <h2>Resolve Your Dispute Without a Lawyer</h2>
    <div class="cta">
      <p>For just <strong>$49.99</strong>, get a professionally written, legally backed letter to help resolve housing, credit, or CAS disputes — fast and affordably.</p>
      <ul>
        <li>AI-powered and customized to your situation</li>
        <li>Delivered instantly as a downloadable PDF</li>
        <li>No subscriptions. No hidden fees.</li>
      </ul>
      <p><strong>Limited-Time Offer: $49.99 until April 15!</strong></p>
      <div id="paypal-button-container" class="button-container"></div>
      <p><img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg" alt="PayPal Secure" width="120"></p>
      <p class="paypal-secure">Secure checkout powered by PayPal.</p>
    </div>

    <div class="testimonials">
      <h3>What Our Users Say:</h3>
      <p class="testimonial">"SmartDispute helped me stand up to my landlord with confidence. The letter was perfect." – J. Miller</p>
      <p class="testimonial">"I didn't know where to start. This platform made it easy, and I won my case." – A. Thomas</p>
    </div>
  </div>

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=Ae4aYzkf6oRX1GtudHIm9UVWx-U55zBh92pgQKVWnvgel5MvWAW3FYh6nEQ5y-_wcpRCjs5omR4AXyZV&currency=CAD"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      paypal.Buttons({
        createOrder: function(data, actions) {
          // Track begin checkout using GTM
          if (window.GTM) {
            window.GTM.trackPayment('PayPal', 'legal_form_submission', 49.99, 'CAD');
            window.GTM.trackConversion('begin_checkout', 'payment_page', {
              value: 49.99,
              currency: 'CAD',
              item_name: 'Legal Form Submission'
            });
          } else {
            // Fallback to standard gtag if GTM not available
            gtag('event', 'begin_checkout', {
              currency: 'CAD',
              value: 49.99,
              items: [{
                item_id: 'legal_form_submission',
                item_name: 'Legal Form Submission',
                price: 49.99,
                quantity: 1
              }]
            });
          }
          
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: '49.99'
              },
              description: 'SmartDispute.ai - Legal Form Submission'
            }]
          });
        },
        onApprove: function(data, actions) {
          // Show empathetic loading animation on payment approval
          const modal = document.createElement('div');
          modal.style.position = 'fixed';
          modal.style.top = '0';
          modal.style.left = '0';
          modal.style.width = '100%';
          modal.style.height = '100%';
          modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
          modal.style.display = 'flex';
          modal.style.justifyContent = 'center';
          modal.style.alignItems = 'center';
          modal.style.zIndex = '1000';
          
          // Create modal content
          const modalContent = document.createElement('div');
          modalContent.style.backgroundColor = 'white';
          modalContent.style.padding = '30px';
          modalContent.style.borderRadius = '8px';
          modalContent.style.width = '90%';
          modalContent.style.maxWidth = '500px';
          modalContent.style.boxShadow = '0 4px 20px rgba(0,0,0,0.2)';
          
          // Create heading
          const heading = document.createElement('h2');
          heading.textContent = 'Processing Your Payment';
          heading.style.marginTop = '0';
          heading.style.color = '#2d3748';
          heading.style.textAlign = 'center';
          
          // Create container for loader
          const loaderContainer = document.createElement('div');
          loaderContainer.id = 'payment-processing-loader';
          
          // Assemble modal
          modalContent.appendChild(heading);
          modalContent.appendChild(loaderContainer);
          modal.appendChild(modalContent);
          
          // Add to body
          document.body.appendChild(modal);
          
          // Start empathetic loader for payment processing
          if (window.EmpatheticLoading) {
            window.EmpatheticLoading.create({
              targetElementId: 'payment-processing-loader',
              context: 'paymentProcessing',
              duration: 5000,
              showProgressBar: true,
              showSupportiveMessages: true
            }).start();
          }
          
          return actions.order.capture().then(function(details) {
            // Track purchase using GTM
            if (window.GTM) {
              window.GTM.trackPayment('PayPal', 'legal_form_submission', 
                parseFloat(details.purchase_units[0].amount.value), 
                details.purchase_units[0].amount.currency_code
              );
              window.GTM.trackConversion('purchase', 'payment_page', {
                transaction_id: details.id,
                value: parseFloat(details.purchase_units[0].amount.value),
                currency: details.purchase_units[0].amount.currency_code,
                item_name: 'Legal Form Submission'
              });
            } else {
              // Fallback to standard gtag if GTM not available
              gtag('event', 'purchase', {
                transaction_id: details.id,
                value: details.purchase_units[0].amount.value,
                currency: details.purchase_units[0].amount.currency_code,
                items: [
                  {
                    item_id: 'legal_form_submission',
                    item_name: 'Legal Form Submission',
                    price: parseFloat(details.purchase_units[0].amount.value),
                    quantity: 1
                  }
                ]
              });
            }

            // Redirect after success (with a slight delay to show the animation)
            setTimeout(function() {
              window.location.href = "/success.html?order_id=" + details.id;
            }, 3000);
          });
        },
        onCancel: function(data) {
          // Track payment cancellation
          if (window.GTM) {
            window.GTM.trackConversion('payment_cancelled', 'payment_page', {
              product_type: 'legal_form_submission'
            });
          } else {
            gtag('event', 'payment_cancelled', {
              event_category: 'ecommerce'
            });
          }
        },
        onError: function(err) {
          // Track payment errors
          if (window.GTM) {
            window.GTM.trackConversion('payment_error', 'payment_page', {
              error_message: err,
              product_type: 'legal_form_submission'
            });
          } else {
            gtag('event', 'payment_error', {
              event_category: 'ecommerce',
              event_label: err
            });
          }
          
          console.error('PayPal error:', err);
        }
      }).render('#paypal-button-container');
    });
  </script>
</body>
</html>